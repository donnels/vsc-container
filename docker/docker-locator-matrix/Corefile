# Handle internal warp bubble domains with hosts file
${CERT_DOMAIN} {
    hosts /tmp/hosts {
        fallthrough
    }
    
    # Enable error logging
    errors
    
    # Enable health check endpoint
    health {
        lameduck 5s
    }
}

# Handle all other domains (external DNS)
. {
    # Auto-detect local DNS from system configuration
    # This will use Fritz Box (10.251.2.1) when home, mobile DNS when traveling
    forward . /etc/resolv.conf
    
    # Enable caching for external queries
    cache 30
    
    # Enable error logging
    errors
    
    # Enable health check endpoint
    health {
        lameduck 5s
    }
    
    # Enable metrics
    prometheus :9153
}
