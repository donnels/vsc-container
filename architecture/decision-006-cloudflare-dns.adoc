:ARC-ID: 006
:ARC-TITLE: Cloudflare DNS Provider for Certificate Management
:ARC-TOPIC: infrastructure
:ARC-STATUS: accepted

[#ARCID-{arc-id}]
= {arc-id} - {arc-topic} - {arc-title}
This decision is part of the {arc-topic} architecture.

== Context

Warp bubble requires automated SSL certificate generation for internal services using Let's Encrypt. Services operate on private networks (172.20.0.0/16), making HTTP-01 challenge infeasible. DNS-01 challenge requires DNS provider with API access.

== Problem Statement / Motivation

Let's Encrypt DNS-01 challenge requires programmatic DNS record control to prove domain ownership. Mobile warp bubble environment makes HTTP-01 validation impossible. Need cost-effective, reliable DNS provider with robust API for automated certificate lifecycle management.

== Alternatives Considered

=== Route 53 (AWS)

.Pro
* Excellent API documentation
* High reliability and performance
* Comprehensive DNS features
* AWS ecosystem integration

.Con
* Higher cost
* Requires AWS account setup
* Complex pricing
* Overkill for simple DNS

=== Cloudflare DNS

.Pro
* Free tier for basic DNS
* Excellent API with documentation
* Native Let's Encrypt integration
* Low cost for additional features
* High performance global network
* Simple API token authentication
* Wide certbot plugin support

.Con
* Requires domain transfer to Cloudflare nameservers
* Free tier limitations
* Single provider dependency

=== Self-Hosted DNS (BIND/PowerDNS)

.Pro
* Complete infrastructure control
* No external dependencies
* No recurring costs

.Con
* Significant maintenance overhead
* Requires DNS expertise
* Complex API development
* No Let's Encrypt integration
* Single point of failure
* Security management complexity

== Decision Outcome

Use Cloudflare as DNS provider for vsagcrd.org domain management, leveraging API for automated Let's Encrypt certificate generation via DNS-01 challenge.

=== Justification

Cloudflare provides optimal balance of cost-effectiveness, reliability, and API functionality for automated certificate management. Native Let's Encrypt compatibility and comprehensive certbot plugin support make certificate automation straightforward.

=== Consequences

* Cloudflare API token required for automation
* Dependency on Cloudflare service availability
* Simplified certificate management automation
* Low operational cost for DNS services
* Access to additional Cloudflare features (CDN, security)
** not required for this project
** potential for cloudflared tunnel integration

=== Implementation Requirements

* Cloudflare account setup and domain transfer
* API token with Zone:Read and DNS:Edit permissions
* Certbot cloudflare plugin configuration
* DNS record management through Cloudflare dashboard or API
* Backup DNS configuration documentation

=== Derived / Related Decisions

* HTTPS certificates required (<<ARCID-001>>)
* DNS infrastructure within warp bubble (<<ARCID-003>>)
* Centralized environment configuration (<<ARCID-005>>)
