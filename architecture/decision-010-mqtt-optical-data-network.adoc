:ARC-ID: 010
:ARC-TITLE: MQTT Message Bus for Optical Data Network
:ARC-TOPIC: communication
:ARC-STATUS: accepted

[#ARCID-{arc-id}]
= {arc-id} - {arc-topic} - {arc-title}
This decision is part of the {arc-topic} architecture.

== Context

Warp bubble requires real-time communication between services for status updates, configuration changes, event coordination. Traditional HTTP polling creates unnecessary network overhead.

== Problem Statement / Motivation

Services need real-time communication for:
- Configuration updates across containers
- Status monitoring and health checks
- Event coordination between services
- Real-time data sharing

HTTP polling inefficient for real-time requirements. Need lightweight pub/sub messaging for container communication.

== Alternatives Considered

=== HTTP Polling

.Pro
* Simple implementation
* Stateless protocol
* Wide compatibility

.Con
* High network overhead
* Poor real-time performance
* Increased latency
* Resource waste

=== Redis Pub/Sub

.Pro
* High performance
* Redis ecosystem benefits
* Memory-based speed

.Con
* Additional complexity
* Memory requirements
* Persistence concerns

=== MQTT Message Bus

.Pro
* Lightweight protocol
* Pub/sub architecture
* Quality of service levels
* Retained messages
* Low resource usage

.Con
* Additional broker service
* MQTT learning curve

== Decision Outcome

Implement MQTT message bus using Mosquitto for real-time inter-service communication within warp bubble.

=== Justification

MQTT provides lightweight, efficient pub/sub messaging ideal for container environments. Retained messages enable status persistence, while QoS levels ensure reliable delivery.

=== Consequences

* Mosquitto MQTT broker within warp bubble (named OPTICAL-DATA-NETWORK)
* Services implement MQTT clients for communication
* Topics organized by service and function
* Retained messages for status persistence
* WebSocket support for browser clients

=== Topic Structure

* `warp/status/<service>` - Service health status
* `warp/config/<service>` - Configuration updates
* `warp/events/<service>` - Service events
* `warp/monitor/<metric>` - Monitoring data

=== Derived / Related Decisions

* DNS infrastructure for broker resolution (<<ARCID-003>>)
* Centralized configuration for MQTT settings (<<ARCID-005>>)
* LCARS interface displays real-time status (<<ARCID-007>>)
